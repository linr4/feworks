<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title> 进度条练习 - 第3遍 </title>
    <style>

        * {
            margin: 0;
            padding: 0;
        }

        .progress-bar {
            width: 1000px;
            /*height: 60px;*/
            margin: 100px auto;

            position: relative;
        }

        #prog_bg {
            width: 900px;
            height: 35px;
            background-color: #cccccc;

            border-radius: 8px;

        }

        #prog_fg {
            width: 0;
            height: 35px;
            background-color: skyblue;

            border-top-left-radius: 8px;
            border-bottom-left-radius: 8px;

            position: relative;
        }

        #prog_tag {
            width: 20px;
            height: 51px;
            border-radius: 8px;
            background-color: darkslategray;

            position: absolute;
            top: -8px;
            left: 0;
        }

        #prog_pct {
            width: 100px;
            height: 35px;
            line-height: 35px;
            text-align: center;

            position: absolute;
            top: 0;
            right: 0;
        }

    </style>
</head>
<body>

<section class="progress-bar">
    <div id="prog_bg">
        <div id="prog_fg">
            <div id="prog_tag">

            </div>
        </div>
    </div>
    <div id="prog_pct">0%</div>
</section>


<script>

    window.addEventListener('load', function () {

        // 获取元素ID：
        var prog_bg = document.querySelector('#prog_bg');
        var prog_fg = document.querySelector('#prog_fg');
        var prog_tag = document.querySelector('#prog_tag');
        var prog_pct = document.querySelector('#prog_pct');

        // 监听调节块的鼠标按下的事件（尝试了用addEventListener，但鼠标释放后不知道怎么清除事件，所以只能先用onXXX监听事件）：

        prog_tag.onmousedown = function (evMouseDown) {
            var initialMouseOffset = evMouseDown.clientX - this.offsetLeft; // 鼠标按下后之后的初始偏移量，作为后续鼠标移动距离的参照点；
            var progBarLength = prog_bg.offsetWidth - prog_tag.offsetWidth;

            // 监听鼠标的移动事件：
            document.onmousemove = function (evMouseMove) {
                var mouseMoveOffset = evMouseMove.clientX - initialMouseOffset; // 计算鼠标移动距离；
                var mouseMovePct = 0;

                if (mouseMoveOffset <=0 ) { // 设置调节块的左边最小值，以防拉出界
                    mouseMoveOffset = 0;
                } else if (mouseMoveOffset >= progBarLength) {
                    mouseMoveOffset = progBarLength;    // 设置调节块的右边最大值，以防拉出界
                }

                prog_fg.style.width = mouseMoveOffset + 'px';   // 按照移动距离设置进度条宽度；
                prog_tag.style.left = mouseMoveOffset + 'px';   // 按照移动距离设置调节块水平位置；

                mouseMovePct = Math.floor(mouseMoveOffset / progBarLength  * 100);  // 计算移动百分比
                prog_pct.innerText = mouseMovePct + '%';

                return false;
            };

            document.onmouseup = function () {     // 鼠标释放后，清除鼠标移动相关的动作；
                this.onmousemove = null;
            }
        };

    })

</script>
</body>
</html>