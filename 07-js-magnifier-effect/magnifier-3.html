<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>放大镜 练习 - 第3遍</title>
    <style>

        /* 大、中、小图的盒子均设置相对定位（相对于自身在原来标准流中的位置），遮罩用绝对定位（父盒子 boxM 相对定位，子绝父相）;
           试过之后发现，如果使用display: none 把大图和遮罩隐藏之后，小图的top因是相对于boxL来定位，boxL隐藏、小图会往上移动；
           因此改用 visibility: hidden 来隐藏大图和遮罩（与display: none 的区别是隐藏但仍占位）；
        */

        html, body, div, img {
            margin: 0;
            padding: 0;
        }

        #boxM {
            width: 350px;
            height: 350px;

            position: relative;
            left: 200px;
            top: 200px;

            border: 1px solid #cccccc;
        }

        #mask {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background-color: rgba(255,255,0, .3);
            visibility: hidden;

            position: absolute;
            left: 0;
            top: 0;

        }

        #boxL {
            width: 600px;
            height: 600px;
            overflow: hidden;
            visibility: hidden;

            position: relative;
            left: 553px;
            top: -152px;
            border: 1px solid #cccccc;
        }

        #boxL img {
            position: absolute;
            left: 0;
            top: 0;
        }

        #boxS {
            width: 350px;
            border: 1px solid #cccccc;
            text-align: center;

            position: relative;
            top: -383px;
            left: 200px;
        }

        #boxS img {
            margin: 10px;
        }

    </style>
</head>
<body>

<!--

Element IDs explanation:
boxL: Large-sized image show box;
boxM: Mediate-sized image show box;
boxS: Small-sized image show box;

-->

<div id="boxM">
    <img src="images/pic001.jpg" alt="">
    <span id="mask"></span>
</div>
<div id="boxL">
    <img src="images/pic01.jpg" alt="">
</div>
<div id="boxS">
    <img src="images/pic0001.jpg" alt="">
    <img src="images/pic0002.jpg" alt="">
    <img src="images/pic0003.jpg" alt="">
</div>


<script>

    window.addEventListener('load', function () {

        // get all IDs those will be needed;
        var boxM = document.getElementById('boxM');
        var boxL = document.getElementById('boxL');
        var boxS = document.getElementById('boxS');
        var mask = document.getElementById('mask');

        // monitor mouse over/out events of boxM so as to display/hide boxL & mask

        boxM.onmouseover = function () {
            boxL.style.visibility = 'visible';
            mask.style.visibility = 'visible';
        };

        boxM.onmouseout = function () {
            boxL.style.visibility = 'hidden';
            mask.style.visibility = 'hidden';
        };

        // monitor mouse movement event so as to make the mask to move accordingly in boxM
        boxM.onmousemove = function (ev) {
            var _event = ev || window.event;
            var maskPosX = _event.pageX - this.offsetLeft - mask.offsetWidth/2;
            var maskPosY = _event.pageY - this.offsetTop - mask.offsetHeight/2;

            // set boundary to retain the movement of the mask
            if (maskPosX <= 0) {    // minimum horizontal boundary
                maskPosX = 0;
            } else if (maskPosX >= this.offsetWidth - mask.offsetWidth) {     // maximum horizontal boundary
                maskPosX = this.offsetWidth - mask.offsetWidth;
            }

            if (maskPosY <= 0) { // minimum vertical boundary
                maskPosY = 0;
            } else if (maskPosY >= this.offsetHeight - mask.offsetHeight) { // maximum vertical boundary
                maskPosY = this.offsetHeight - mask.offsetHeight;
            }

            // set the position of the mask according to mouse cursor
            mask.style.left = maskPosX + 'px';
            mask.style.top = maskPosY + 'px';

            // calculator how far the bic pic should be moved according to the movement of the mask
            var bigPicPosX = (boxL.offsetWidth / boxM.offsetWidth) * maskPosX;  //  = mask movement pace multiplies the ratio of boxM & boxL
            var bigPicPosY = (boxL.offsetHeight / boxM.offsetHeight) * maskPosY;

            boxL.children[0].style.left = -bigPicPosX + 'px';   // add minus symbol so as to move in the opposite direction of the mask
            boxL.children[0].style.top = -bigPicPosY + 'px';

        };

        // switch to respective pics in M-size and L-size when the mouse hovers on the small pics
        for (var i = 0; i < boxS.children.length; i++) {
            var smallPic = boxS.children[i];
            smallPic.id = i + 1;    // To add pic's ID as a temp register so as to realize async exec of mouseover event

            smallPic.onmouseover = function () {
                boxM.children[0].src = 'images/pic00' + this.id + '.jpg';
                boxL.children[0].src = 'images/pic0' + this.id + '.jpg';
            }
        }

    })

</script>
</body>
</html>