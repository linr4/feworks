<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>进度条练习 - 第4遍</title>

    <style>

        * {
            margin: 0;
            padding: 0;
        }

        .progress-bar {
            width: 1000px;
            margin: 100px auto;
        }

        #prg_bg {
            width: 900px;
            height: 35px;
            background-color: #cccccc;
            border-radius: 10px;

            float: left;
        }

        #prg_fg {
            width: 0;
            height: 35px;
            background-color: skyblue;
            border-bottom-left-radius: 10px;
            border-top-left-radius: 10px;

            position: relative;
        }

        #prg_tag {
            width: 20px;
            height: 51px;
            background-color: deepskyblue;
            border-radius: 10px;

            position: absolute;
            top: -8px;
            left: 0;
        }

        #prg_val {
            height: 100%;
            line-height: 35px;
            width: 100px;
            text-align: center;
            float: right;
        }


    </style>

</head>
<body>

    <section class="progress-bar">
        <div id="prg_bg">
            <div id="prg_fg">
                <div id="prg_tag"></div>
            </div>
        </div>

        <div id="prg_val">0%</div>
    </section>


    <script>

        window.addEventListener('load', function () {

            // 获取所需的ID：
            var prg_bg = document.getElementById('prg_bg');
            var prg_fg = document.getElementById('prg_fg');
            var prg_tag = document.getElementById('prg_tag');
            var prg_val = document.getElementById('prg_val');

            prg_tag.onmousedown = function (evMouseDown) {
                var initialMouseOffset = evMouseDown.clientX - this.offsetLeft;     // 获取鼠标初始位置的偏移量；
                var prgBarStepLength = prg_bg.offsetWidth - prg_tag.offsetWidth;

                document.onmousemove = function (evMouseMove) {
                    var mouseMoveOffset = evMouseMove.clientX - initialMouseOffset; // 获取鼠标位移量；
                    var mouseMovePct = 0;   // 位移量的百分比；

                    if (mouseMoveOffset < 0) {
                        mouseMoveOffset = 0;  // 设置最小值以防调节块移出左边界；
                    } else if (mouseMoveOffset > prgBarStepLength) {
                        mouseMoveOffset = prgBarStepLength;    // 设置最大值以防调节块移出右边界；
                    }

                    prg_fg.style.width = mouseMoveOffset + 'px';    // 跟随调节块的拖动，设置进度条宽度；
                    prg_tag.style.left = mouseMoveOffset + 'px';    // 跟随拖动，设置调节块的位置；

                    mouseMovePct = Math.floor(mouseMoveOffset / prgBarStepLength * 100);    // 计算位移量的百分比；
                    prg_val.innerText = mouseMovePct + '%';     // 显示位移量百分比；

                    return false;
                };

                document.onmouseup = function () {
                    this.onmousemove = null;    // 释放鼠标时，清除鼠标移动相关的事件和动作；
                }

            }
        });

    </script>

</body>
</html>